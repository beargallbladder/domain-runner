<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw Capture Runner Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">Raw Capture Runner Dashboard</h1>
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-2">Total Responses</h3>
                <p id="total-responses" class="text-3xl font-bold text-blue-600">-</p>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-2">Average Tokens</h3>
                <p id="avg-tokens" class="text-3xl font-bold text-green-600">-</p>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-2">Average Latency</h3>
                <p id="avg-latency" class="text-3xl font-bold text-purple-600">-</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">Domain Status</h3>
                <canvas id="domain-status-chart"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">Response Trends</h3>
                <canvas id="response-trend-chart"></canvas>
            </div>
        </div>

        <!-- Alerts and Errors -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">Recent Alerts</h3>
                <div id="alerts-list" class="space-y-4 max-h-96 overflow-y-auto"></div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">Recent Errors</h3>
                <div id="errors-list" class="space-y-4 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script>
        // Fetch and update stats
        async function updateStats() {
            const response = await fetch('/api/stats');
            const data = await response.json();
            
            document.getElementById('total-responses').textContent = data.responses.total_responses;
            document.getElementById('avg-tokens').textContent = Math.round(data.responses.avg_tokens);
            document.getElementById('avg-latency').textContent = Math.round(data.responses.avg_latency) + 'ms';

            // Update domain status chart
            const statusLabels = data.domains.map(d => d.status);
            const statusData = data.domains.map(d => d.count);
            
            new Chart(document.getElementById('domain-status-chart'), {
                type: 'doughnut',
                data: {
                    labels: statusLabels,
                    datasets: [{
                        data: statusData,
                        backgroundColor: [
                            '#60A5FA',
                            '#34D399',
                            '#F87171',
                            '#A78BFA'
                        ]
                    }]
                }
            });
        }

        // Fetch and update alerts
        async function updateAlerts() {
            const response = await fetch('/api/alerts');
            const alerts = await response.json();
            
            const alertsList = document.getElementById('alerts-list');
            alertsList.innerHTML = alerts.map(alert => `
                <div class="border-l-4 border-yellow-500 bg-yellow-50 p-4">
                    <div class="flex justify-between">
                        <p class="font-semibold">${alert.details.message}</p>
                        <span class="text-sm text-gray-500">${new Date(alert.details.timestamp).toLocaleString()}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">Level: ${alert.details.level}</p>
                </div>
            `).join('');
        }

        // Fetch and update errors
        async function updateErrors() {
            const response = await fetch('/api/errors');
            const errors = await response.json();
            
            const errorsList = document.getElementById('errors-list');
            errorsList.innerHTML = errors.map(error => `
                <div class="border-l-4 border-red-500 bg-red-50 p-4">
                    <div class="flex justify-between">
                        <p class="font-semibold">${error.details.message}</p>
                        <span class="text-sm text-gray-500">${new Date(error.details.timestamp).toLocaleString()}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">${error.details.context ? JSON.stringify(error.details.context) : ''}</p>
                </div>
            `).join('');
        }

        // Update everything every 30 seconds
        async function updateDashboard() {
            await Promise.all([
                updateStats(),
                updateAlerts(),
                updateErrors()
            ]);
        }

        // Initial update
        updateDashboard();

        // Set up periodic updates
        setInterval(updateDashboard, 30000);
    </script>
</body>
</html> 