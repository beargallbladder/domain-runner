swarm:
  name: sentinel-score
  depends_on: sentinel-crawl
  steps:
    - name: compute-scores
      run: >
        node services/runner-node/src/score.js
        --in runs/${RUN_ID}/crawl.jsonl
        --algorithm weighted_average
        --out runs/${RUN_ID}/score.json
      timeout_seconds: 120
    
    - name: calculate-metrics
      run: >
        python scripts/parse_metrics.py
        --score runs/${RUN_ID}/score.json
        --crawl runs/${RUN_ID}/crawl.jsonl
        --errors runs/${RUN_ID}/error_buckets.json
        --out runs/${RUN_ID}/metrics.json
    
    - name: compare-previous
      run: >
        python scripts/diff_runs.py
        --current runs/${RUN_ID}
        --previous runs/latest
        --out runs/${RUN_ID}/comparison.json
      continue_on_error: true
    
    - name: validate-scores
      run: >
        python scripts/validate_scores.py
        --scores runs/${RUN_ID}/score.json
        --min-score 0.0
        --max-score 1.0
        --required-fields "memory_score,consensus_score,brand,timestamp"